<!DOCTYPE html>  <html> <head>   <title>backbone-events.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               backbone-events.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>Backbone Events 0.0.1

by Ian Storm Taylor
https://github.com/ianstormtaylor/backbone-events
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">;(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">_</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Couldn\&#39;t find Underscore&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">Backbone</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Couldn\&#39;t find Backbone&#39;</span><span class="p">);</span>

  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">||</span> <span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="p">{});</span>
  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A regex to split commas with optional spaces around them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">commaSplitter</span> <span class="o">=</span> <span class="sr">/\s*,\s*/</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>A regex to split dot-separated, properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">propertySplitter</span> <span class="o">=</span> <span class="sr">/\./g</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Delegates all Backbone events as passed in or as defined in
<code>this.backboneEvents</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">delegateBackboneEvents</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">events</span> <span class="o">||</span> <span class="p">(</span><span class="nx">events</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">backboneEvents</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">undelegateBackboneEvents</span><span class="p">();</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">keys</span>   <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">commaSplitter</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">?</span> <span class="p">[</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span> <span class="o">:</span> <span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Event</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid event: &#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Subject</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>If we have a subject other than this...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Split subject from sub-subjects.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">subjects</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="nx">propertySplitter</span><span class="p">);</span>
          <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Recursively travel down properties, and allow for the properties
actually being inside a Model's <code>attributes</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">subsubject</span><span class="p">;</span> <span class="nx">subsubject</span> <span class="o">=</span> <span class="nx">subjects</span><span class="p">[</span><span class="nx">l</span><span class="p">];</span> <span class="nx">l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">subject</span> <span class="o">=</span> <span class="nx">subject</span> <span class="k">instanceof</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span> <span class="o">?</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">subsubject</span><span class="p">)</span> <span class="o">:</span> <span class="nx">subject</span><span class="p">[</span><span class="nx">subsubject</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Iterate over values, binding each one to the subject + event.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">commaSplitter</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>Method</h2>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">methods</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="nx">propertySplitter</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Either a method on a subview or a method on this.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">methods</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nx">methods</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">:</span> <span class="k">this</span><span class="p">[</span><span class="nx">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Cant find method: &#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Context</h2>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If a context is passed in use it, otherwise if the method has a
subject other than this use it's subject, otherwise use this.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;this&#39;</span><span class="p">)</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">methods</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Bind</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Bind to each event in the list. Subjects always fail silently so
that events can be added to the dictionary even if the subject only
gets created in certain cases. Otherwise, those cases would always
require breaking out of the dictionary and then it isn't as useful
because it doesn't hold all your events nicely.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">subject</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">subject</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">context</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Undelegates all previously delegated Backbone events.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">undelegateBackboneEvents</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">args</span><span class="p">;</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_backboneEvents</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">off</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 